#!/bin/bash

export POSIXLY_CORRECT=yes
export LC_NUMERIC=en_US.UTF-8

print_help()
{
  echo "Usage: tradelog [-h|--help]"
  echo "       tradelog [FILTER...] [COMMAND] [LOG...]"
  echo ""
}

remove_char()
{
  str=${1::$((${#1} - ${2}))}
}

COMMAND=""
LOG_FILES=""
GZ_LOG_FILES=""

DATETIMEa=""
DATETIMEb="9999-99-99"

TICKER=""
TICKERtmp=""
WIDTH=""

if [ "$#" -eq 0 ]; then
  echo "error"
  exit 1
fi

if [ "$1" = "--help" ]; then
  print_help
  exit 0
fi


WIDTH_CHECK=1
while getopts "a:b:t:w:h" args; do
  case "$args" in
    a)
      DATETIMEa="$OPTARG"
    ;;
    b)
      DATETIMEb="$OPTARG"
    ;;
    t)
      TICKERtmp="$TICKERtmp$OPTARG\|"
    ;;
    w)
      WIDTH="$OPTARG"
    ;;
    h)
      print_help
      exit 0
    ;;
    \?)
      echo "Spatny prepinac"
      exit 1
    ;;
    : )
      echo "adadas"
    ;;
    *)
      echo "ada"
      exit 1
    ;;
  esac
done

echo "$TICKERtmp"

if [ "$TICKERtmp" != "" ] ; then
  echo "deje"
  TICKER=$(echo -n $TICKERtmp | head -c -2)
fi

echo "Adda$TICKERtmp   dad"
echo "$TICKER cusik"

#COMMAND FILTRATION
shift $((OPTIND-1))
COMMAND=$1
echo "adsad $COMMAND"
echo "$@"

#NOT COMMAND -> PRINT FILE(S)
if [ -f "$COMMAND" ]; then
  echo "1"
  for file in "$@"; do
    echo "$file"
    if [ "${file##*.}" = "gz" ] && [ "$TICKER" = "" ]; then
      echo "2"
      gzip -c -d "${file}"
    elif [ "${file##*.}" = "log" ] && [ "$TICKER" = "" ]; then
      echo "3"
      cat "$file"
    elif [ "${file##*.}" = "gz" ] && [ "$TICKER" != "" ]; then
      echo "4"
      gzip -c -d "${file}" | grep -w "$TICKER"
    elif [ "${file##*.}" = "log" ] && [ "$TICKER" != "" ]; then
      echo "5"
      cat "$file" | grep -w "$TICKER"
    fi
  done
  exit 0
fi

for file in $# ; do
  if [ "$file" = \*.gz ]; then
    GZ_LOG_FILES="GZ_LOG_FILES${file} "
  elif [ -f "$file" ] && [ "$file" != \*.gz ]; then
    LOG_FILES="LOG_FILES${file} "
  fi
done

echo "$LOG_FILES"

if [ "$GZ_LOG_FILES" != "" ] && [ "$LOG_FILES" = "" ]; then
  read_input="zcat $GZ_LOG_FILES"
fi

if [ "$GZ_LOG_FILES" = "" ] && [ "$LOG_FILES" != "" ]; then
  read_input="cat $LOG_FILES"
fi

if [ "$GZ_LOG_FILES" != "" ] && [ "$LOG_FILES" != "" ]; then
  read_input="cat ${LOG_FILES}| zcat ${GZ_LOG_FILES}"
fi

echo "$dasdas read_input"

if [ "$COMMAND" = "list-tick" ]; then
  cat  | awk -F';' '{print $2}' | grep -w "$TICKER" | sort -u
fi

exit 0









